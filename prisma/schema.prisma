generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  username      String
  password      String?
  googleId      String?  @unique
  location      String?
  mapsLink      String?
  longitude     Float?
  latitude      Float?
  phoneNumber   Int?
  profileImage  String?
  role          UserRole
  emailVerified Boolean  @default(false)
  offers        Offer[]
  orders        Order[]
}

model Offer {
  id              Int       @id @default(autoincrement())
  ownerId         Int?
  title           String
  description     String
  price           Float?
  originalPrice   Float?
  expirationDate  DateTime
  pickupStartTime DateTime?
  pickupEndTime   DateTime?
  mapsLink        String?
  latitude        Float?
  longitude       Float?
  images          Json
  quantity        Int
  foodType        FoodType? @default(other)
  taste           Taste?    @default(neutral)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  owner           User?     @relation(fields: [ownerId], references: [id])
  orders          Order[]

  @@index([ownerId])
  @@index([createdAt(sort: Desc)])
  @@index([expirationDate])
  @@index([foodType])
}

model Order {
  id          Int       @id @default(autoincrement())
  quantity    Int
  userId      Int
  offerId     Int
  status      Status    @default(pending)
  qrCodeToken String?   @unique
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  collectedAt DateTime?
  offer       Offer     @relation(fields: [offerId], references: [id])
  user        User      @relation(fields: [userId], references: [id])
  rating      Rating?

  @@index([userId])
  @@index([offerId])
  @@index([status])
  @@index([createdAt(sort: Desc)])
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  subject   String?
  message   String
  userRole  String?
  userId    Int?
  createdAt DateTime @default(now())
  read      Boolean  @default(false)
}

model Rating {
  id         Int      @id @default(autoincrement())
  orderId    Int      @unique
  providerId Int
  userId     Int
  rating     Int
  tags       Json?
  comment    String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([providerId])
  @@index([userId])
}

enum Status {
  expired
  confirmed
  cancelled
  pending
}

enum UserRole {
  CLIENT
  PROVIDER
  PENDING_PROVIDER
  NONE
}

enum FoodType {
  snack
  meal
  beverage
  other
}

enum Taste {
  sweet
  salty
  both
  neutral
}
