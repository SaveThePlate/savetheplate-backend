generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  googleId     String?  @unique
  location     String?
  phoneNumber  Int?
  profileImage String?
  username     String
  role         UserRole
  latitude     Float?
  longitude    Float?
  mapsLink     String?  @db.Text
  offers       Offer[]
  orders       Order[]
}

model Offer {
  id              Int       @id @default(autoincrement())
  title           String
  description     String
  expirationDate  DateTime
  images          Json
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  latitude        Float?
  longitude       Float?
  ownerId         Int?
  price           Float?
  quantity        Int
  mapsLink        String?   @db.Text
  originalPrice   Float?
  pickupEndTime   DateTime?
  pickupStartTime DateTime?
  foodType        FoodType? @default(other)
  taste           Taste?    @default(neutral)
  owner           User?     @relation(fields: [ownerId], references: [id])
  orders          Order[]

  @@index([ownerId], map: "Offer_ownerId_fkey")
}

model Order {
  id          Int       @id @default(autoincrement())
  quantity    Int
  userId      Int
  offerId     Int
  createdAt   DateTime  @default(now())
  status      Status    @default(pending)
  collectedAt DateTime?
  updatedAt   DateTime  @updatedAt
  qrCodeToken String?   @unique
  offer       Offer     @relation(fields: [offerId], references: [id])
  user        User      @relation(fields: [userId], references: [id])
  Rating      Rating?

  @@index([offerId], map: "Order_offerId_fkey")
  @@index([userId], map: "Order_userId_fkey")
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  subject   String?
  message   String   @db.Text
  userRole  String?
  userId    Int?
  createdAt DateTime @default(now())
  read      Boolean  @default(false)
}

model Rating {
  id         Int      @id @default(autoincrement())
  orderId    Int      @unique
  providerId Int
  userId     Int
  rating     Int
  tags       Json?
  comment    String?  @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  Order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

enum Status {
  expired
  confirmed
  cancelled
  pending
}

enum UserRole {
  CLIENT
  PROVIDER
  PENDING_PROVIDER
  NONE
}

enum FoodType {
  snack
  meal
  beverage
  other
}

enum Taste {
  sweet
  salty
  both
  neutral
}
